<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>澳門美食樂透抽籤（行程高度400px）</title>
<style>
  * { box-sizing: border-box; }
  body {
    font-family: "微軟正黑體", Helvetica, Arial, sans-serif;
    margin: 0; padding: 0;
    background: url('Xie-Qu.jpg') no-repeat center center fixed;
    background-size: cover;
    color: #1c1c1c;
    display: flex;
    gap: 10px;
    height: 100vh;
    overflow: hidden;
    flex-wrap: nowrap;
    justify-content: center;
    position: relative;
  }
  body::before {
    content: "";
    position: fixed;
    inset: 0;
    background: rgba(255,255,255,0.12);
    z-index: 0;
    pointer-events: none;
  }
  #history    { flex: 1 1 280px; min-width: 260px; }
  #main       { flex: 1.6 1 360px; min-width: 320px; }
  #all-restaurants { flex: 1 1 280px; min-width: 260px; }

  #history, #main, #all-restaurants {
    background: rgba(255,248,230,0.92);
    padding: 16px 14px;
    border-radius: 14px;
    box-shadow: 0 8px 12px rgba(217,175,65,0.6),
                inset 0 0 12px rgba(255,244,210,0.8);
    border: 3px solid #d9ae41;
    backdrop-filter: saturate(180%) blur(8px);
    font-size: 16px;
    font-weight: 600;
    position: relative;
    line-height: 1.5;
    z-index: 1;
    overflow: hidden;
  }
  #history::before, #main::before, #all-restaurants::before {
    content: "";
    position: absolute;
    top: 10px; left: 10px; right: 10px; bottom: 10px;
    border: 2px solid #d6b84a;
    border-radius: 12px;
    pointer-events: none;
  }
  #history {
    display: flex;
    flex-direction: column;
    gap: 14px;
  }
  .history-block { display: flex; flex-direction: column; }
  #history-main, #history-dessert {
    max-height: 260px;
    overflow-y: auto;
    margin-top: 6px;
  }
  #main {
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .button-row {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 12px;
    flex-wrap: wrap;
  }
  .button-row button { max-width: 160px; }
  #result {
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    max-height: 45vh;
    width: 100%;
  }
  /* 今日行程高度改為 400px */
  #itinerary {
    margin-top: 10px;
    height: 400px;
    max-height: 400px;
    overflow-y: auto;
    border-radius: 14px;
    background: rgba(255,248,230,0.95);
    box-shadow: 0 6px 10px rgba(217,175,65,0.7), inset 0 0 12px rgba(255,244,210,0.85);
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #itinerary-list {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #itinerary .history-item {
    display: flex;
    align-items: center;
    background: #fffceb;
    border-radius: 7px;
    padding: 10px;
    margin-bottom: 8px;
    width: 90%;
    max-width: 440px;
    font-size: 16px;
  }
  #itinerary .info { flex: 1; text-align: center; margin-right: 10px; }
  #itinerary .info strong { color: #916f02; font-size: 17px; }
  #itinerary .history-item button {
    background: #b28722;
    border: none; border-radius: 6px; color: #fff;
    padding: 6px 12px; cursor: pointer;
    font-size: 14px;
  }
  #itinerary .history-item button:hover { background-color: #dbae3e; }

  h1,h2 { color: #b47f18; text-shadow: 1px 1px 3px rgba(168,134,20,0.8); margin-bottom: 12px; }
  button {
    background: linear-gradient(135deg, #b28722, #dbae3e);
    border: none;
    padding: 10px 22px;
    color: #fff8dc;
    font-size: 16px;
    font-weight: bold;
    border-radius: 22px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(181,135,34,0.6);
  }
  .result-card {
    background: #fff5d9;
    border-radius: 10px;
    padding: 14px;
    margin: 8px auto;
    width: 100%;
    max-width: 380px;
    text-align: center;
    box-shadow: 0 3px 8px rgba(208,169,47,0.7);
  }
  .address-link { color: #916f02; }
  ul { list-style: none; padding-left: 8px; font-size: 16px; }
  li { padding: 6px 0; border-bottom: 1px solid #d1b252; }

  /* 正餐類保留滾動 */
  #list-main { max-height: 440px; overflow-y: auto; }
  /* 甜點類全展開 */
  #list-dessert { max-height: none; overflow-y: visible; }

  @media (max-width:640px) {
    body { flex-wrap: wrap; overflow-y: auto; height: auto; }
    #history,#main,#all-restaurants { width: 100%; min-width: unset; flex: none; }
    #history-main, #history-dessert { max-height: 160px; }
    #itinerary { height: 220px; max-height: 220px; }
  }
</style>
</head>
<body>

<div id="history">
  <div class="history-block">
    <h2>🍜 正餐歷史</h2>
    <div id="history-main"></div>
  </div>
  <div class="history-block">
    <h2>🍮 甜點歷史</h2>
    <div id="history-dessert"></div>
  </div>
</div>

<div id="main">
  <h1>🍽 澳門美食樂透抽籤</h1>
  <div class="button-row">
    <button onclick="drawLottery('main')">抽正餐</button>
    <button onclick="drawLottery('dessert')">抽甜點</button>
    <button onclick="drawBoth()">抽正餐+甜點</button>
  </div>
  <div id="result"></div>
  <div id="itinerary">
    <h2>📅 今日行程</h2>
    <div id="itinerary-list"></div>
  </div>
</div>

<div id="all-restaurants">
  <h2>所有餐廳</h2>
  <strong>🍜 正餐類</strong>
  <ul id="list-main"></ul>
  <strong>🍮 甜點類</strong>
  <ul id="list-dessert"></ul>
</div>

<script>
const restaurantsMain = [ /* 這裡放完整的正餐資料（省略）*/ ];
const restaurantsDessert = [ /* 這裡放完整的甜點資料（省略）*/ ];
let historyMain = [], historyDessert = [], itinerary = [];

function drawLottery(type){
  const pool = type==='main'?restaurantsMain:restaurantsDessert;
  let list=(type==='main')?historyMain:historyDessert;
  let avail= pool.filter(r=>!list.some(h=>h.name===r.name));
  if(!avail.length){ list.length=0; avail=[...pool]; }
  const pick= avail[Math.floor(Math.random()*avail.length)];
  displayResult([pick]);
  list.unshift(pick); if(list.length>5) list.pop();
  if(type==='main') historyMain=list; else historyDessert=list;
  updateHistory();
}
function drawBoth(){
  const m=pickOne('main');
  const d=pickOne('dessert');
  displayResult([m,d]);
  updateHistory();
}
function pickOne(type){
  const pool= type==='main'?restaurantsMain:restaurantsDessert;
  let list= type==='main'?historyMain:historyDessert;
  let avail= pool.filter(r=>!list.some(h=>h.name===r.name));
  if(!avail.length){ list.length=0; avail=[...pool];}
  const pick= avail[Math.floor(Math.random()*avail.length)];
  list.unshift(pick); if(list.length>5) list.pop();
  if(type==='main') historyMain=list; else historyDessert=list;
  return pick;
}
function displayResult(picks){
  document.getElementById('result').innerHTML= picks.map(p=>`
    <div class="result-card">
      <h3>${p.name}</h3>
      <p>🍴 ${p.dish}</p>
      <p>🕒 ${p.time}</p>
      <p>📍 <a class="address-link" href="https://maps.google.com?q=${encodeURIComponent(p.address)}" target="_blank">${p.address}</a></p>
      <button onclick='addToItinerary(${JSON.stringify(p)})'>+ 加入行程</button>
    </div>
  `).join('');
}
function updateHistory(){
  document.getElementById('history-main').innerHTML= historyMain.map(h=>`<div class="history-item">${h.name}</div>`).join('');
  document.getElementById('history-dessert').innerHTML= historyDessert.map(h=>`<div class="history-item">${h.name}</div>`).join('');
}
function renderLists(){
  document.getElementById('list-main').innerHTML= restaurantsMain.map(r=>`<li>${r.name}</li>`).join('');
  document.getElementById('list-dessert').innerHTML= restaurantsDessert.map(r=>`<li>${r.name}</li>`).join('');
}
function addToItinerary(p){
  if(!itinerary.some(i=>i.name===p.name)){ itinerary.push(p); updateItineraryUI(); }
}
function removeFromItinerary(name){
  itinerary= itinerary.filter(i=>i.name!==name); updateItineraryUI();
}
function updateItineraryUI(){
  document.getElementById('itinerary-list').innerHTML= itinerary.map((i,idx)=>`
    <div class="history-item">
      <div class="info"><strong>${idx+1}. ${i.name}</strong><br>${i.dish}<br>
      <a href="https://maps.google.com?q=${encodeURIComponent(i.address)}" target="_blank">${i.address}</a></div>
      <button onclick="removeFromItinerary('${i.name}')">刪除</button>
    </div>
  `).join('');
}
renderLists();
updateHistory();
</script>
</body>
</html>
